{% extends "website/base.html" %}
{% load static %}

{% block title %}Update Branch | SpaceBook{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="d-flex align-items-center mb-4">
    <h2 class="mb-0">
      <i class="bi bi-pencil-square me-2 text-primary"></i>
      Edit UiTM Branch
    </h2>
    <hr class="flex-grow-1 ms-3">
  </div>


  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {{ form.non_field_errors }}

    <div class="mb-3 required">
      <div class="input-group">
        <span class="input-group-text">
          <i class="bi bi-building"></i>
        </span>
        {{ form.name }}
      </div>
      {{ form.name.errors }}
    </div>

    <div class="mb-3 required">
      <div class="input-group">
        <span class="input-group-text">
          <i class="bi bi-geo-alt"></i>
        </span>
        {{ form.location }}
      </div>
      {{ form.location.errors }}
    </div>


  <!-- CURRENT IMAGE PREVIEW -->
  <div class="mt-3">
    <small class="text-muted">Current image:</small><br>
    <img src="{{ MEDIA_URL }}branches/{{ branch.code|lower }}.jpg"
         class="img-thumbnail mt-2"
         style="max-height: 160px;"
         alt="{{ branch.name }}"
         onerror="this.src='{% static 'images/branch-placeholder.jpg' %}'">
  </div>
  
<div class="mb-3">
  <div class="input-group">
    <span class="input-group-text">
      <i class="bi bi-image"></i>
    </span>
    {{ form.image }}
  </div>
  {{ form.image.errors }}
  <div class="form-text text-muted">
    Uploading a new image will replace the existing one.
  </div>
</div>



<button type="submit" class="btn btn-primary">
  <i class="bi bi-check-circle me-1"></i>
  Update Branch
</button>

<a href="{% url 'home' %}" class="btn btn-secondary ms-2">
  <i class="bi bi-x-circle me-1"></i>
  Cancel
</a>



    <script>
      const form = document.querySelector("form");
      if (form) {
        form.addEventListener("submit", function () {
          const buttons = form.querySelectorAll("button[type='submit']");
          buttons.forEach(btn => {
            btn.disabled = true;
            btn.innerText = "Processing...";
          });
        });
      }
    </script>

  </form>
</div>
{% endblock %}
