{% extends "website/base.html" %}
{% load static %}

{% block title %}Update Branch | SpaceBook{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="mb-4">Edit Branch</h2>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {{ form.non_field_errors }}

    <div class="mb-3 required">
      <label class="form-label">{{ form.name.label }}</label>
      {{ form.name }}
      {{ form.name.errors }}
    </div>

    <div class="mb-3 required">
      <label class="form-label">{{ form.state.label }}</label>
      {{ form.state }}
      {{ form.state.errors }}
    </div>

    <div class="mb-3 required">
      <label class="form-label">{{ form.code.label }}</label>
      {{ form.code }}
      {{ form.code.errors }}
    </div>


  <!-- CURRENT IMAGE PREVIEW -->
  <div class="mt-3">
    <small class="text-muted">Current image:</small><br>
    <img src="{{ MEDIA_URL }}branches/{{ branch.code|lower }}.jpg"
         class="img-thumbnail mt-2"
         style="max-height: 160px;"
         alt="{{ branch.name }}"
         onerror="this.src='{% static 'images/branch-placeholder.jpg' %}'">
  </div>
  
<div class="mb-3">
  <label class="form-label">{{ form.image.label }}</label>
  {{ form.image }}
  {{ form.image.errors }}

  <div class="form-text text-muted">
    Uploading a new image will replace the existing one.
  </div>

</div>


    <button type="submit" class="btn btn-primary">Update Branch</button>
    <a href="{% url 'home' %}" class="btn btn-secondary ms-2">Cancel</a>


    <script>
      const form = document.querySelector("form");
      if (form) {
        form.addEventListener("submit", function () {
          const buttons = form.querySelectorAll("button[type='submit']");
          buttons.forEach(btn => {
            btn.disabled = true;
            btn.innerText = "Processing...";
          });
        });
      }
    </script>

  </form>
</div>
{% endblock %}
