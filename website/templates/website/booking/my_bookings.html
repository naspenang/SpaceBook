{% extends "website/base.html" %}

{% block title %}My Bookings | SpaceBook{% endblock %}

{% block content %}
<div class="container py-5" style="max-width: 900px;">

  <h3 class="mb-4">My Bookings</h3>

  {% if bookings %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Space</th>
            <th>Library</th>
            <th>Date</th>
            <th>Time</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for booking in bookings %}
            <tr>
              <td>
                <a href="{% url 'space_detail' booking.space.space_id %}">
                  {{ booking.space.space_name }}
                </a>
              </td>
              <td>
                {{ booking.space.library.library_name }}
              </td>
              <td>
                {{ booking.booking_date }}
              </td>
              <td>
                {{ booking.start_time }} â€“ {{ booking.end_time }}
              </td>
                <td>

                <!-- Booking status -->
                <span class="badge
                  {% if booking.status == 'APPROVED' %}bg-success
                  {% elif booking.status == 'PENDING' %}bg-warning text-dark
                  {% elif booking.status == 'REJECTED' %}bg-danger
                  {% else %}bg-secondary{% endif %}
                ">
                  {{ booking.get_status_display }}
                </span>

                <!-- Payment status -->
                {% if booking.space.requires_payment %}
                  <div class="mt-1">
                    <span class="badge
                      {% if booking.payment_status == 'PAID' %}bg-success
                      {% elif booking.payment_status == 'FAILED' %}bg-danger
                      {% else %}bg-secondary{% endif %}
                    ">
                      {{ booking.payment_status }}
                    </span>
                  </div>
                {% endif %}

                <!-- Pay via FPX button -->
                {% if booking.space.requires_payment and booking.payment_status == "UNPAID" %}
                  <div class="mt-1">
                    <a href="{% url 'fpx_start' booking.id %}"
                      class="btn btn-sm btn-primary">
                      Pay via FPX
                    </a>
                  </div>
                {% endif %}

              </td>


            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">
      You have no bookings yet.
    </p>
  {% endif %}

</div>
{% endblock %}
